{% extends 'base.html' %}

{% block title %}Meu Painel - {{ block.super }}{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="mb-4">Meu Painel</h1>

    <!-- Sistema de Abas do Bootstrap -->
    <div class="card shadow-sm">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="perfil-tab" data-bs-toggle="tab" data-bs-target="#perfil" type="button" role="tab" aria-controls="perfil" aria-selected="true">Meu Perfil</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="cursos-tab" data-bs-toggle="tab" data-bs-target="#cursos" type="button" role="tab" aria-controls="cursos" aria-selected="false">Meus Cursos</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="perguntas-tab" data-bs-toggle="tab" data-bs-target="#perguntas" type="button" role="tab" aria-controls="perguntas" aria-selected="false">Minhas Perguntas</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="respostas-tab" data-bs-toggle="tab" data-bs-target="#respostas" type="button" role="tab" aria-controls="respostas" aria-selected="false">Minhas Respostas</button>
                </li>
            </ul>
        </div>
        <div class="card-body">
            <div class="tab-content p-3" id="myTabContent">

                <!-- Aba 1: Editar Perfil -->
                <div class="tab-pane fade show active" id="perfil" role="tabpanel" aria-labelledby="perfil-tab">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            {% if user.associado.foto_perfil %}
                                <img src="{{ user.associado.foto_perfil.url }}" class="img-fluid rounded-circle mb-3" alt="Foto de Perfil" style="width: 150px; height: 150px; object-fit: cover;">
                            {% else %}
                                <img src="https://placehold.co/150x150/4A69BD/FFFFFF?text={{ user.first_name|first }}" class="img-fluid rounded-circle mb-3" alt="Avatar Padrão">
                            {% endif %}
                        </div>
                        <div class="col-md-8">
                            <h2 class="h4 mb-3">Editar Perfil</h2>
                            {% if messages %}
                                {% for message in messages %}
                                    <div class="alert alert-success" role="alert">
                                        {{ message }}
                                    </div>
                                {% endfor %}
                            {% endif %}
                            <form method="post" enctype="multipart/form-data">
                                {% csrf_token %}
                                {% for field in form %}
                                    <div class="mb-3">
                                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                                        {{ field }}
                                    </div>
                                {% endfor %}
                                <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Aba 2: Meus Cursos -->
                <div class="tab-pane fade" id="cursos" role="tabpanel" aria-labelledby="cursos-tab">
                    <h2 class="h4 mb-3">Cursos em que estou Inscrito</h2>
                    <ul class="list-group">
                        {% for curso in meus_cursos %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                {{ curso.titulo }}
                                <a href="{% url 'cursos:detalhe_curso' pk=curso.pk %}" class="btn btn-sm btn-outline-primary">Ver Curso</a>
                            </li>
                        {% empty %}
                            <li class="list-group-item text-muted">Você ainda não está inscrito em nenhum curso.</li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Aba 3: Minhas Perguntas -->
                <div class="tab-pane fade" id="perguntas" role="tabpanel" aria-labelledby="perguntas-tab">
                    <h2 class="h4 mb-3">Minhas Perguntas</h2>
                    <ul class="list-group">
                        {% for pergunta in minhas_perguntas %}
                            <li class="list-group-item">
                                <a href="{% url 'cursos:ver_aula' pk=pergunta.aula.pk %}">
                                    "{{ pergunta.conteudo|truncatewords:15 }}"
                                </a>
                                <div class="small text-muted mt-1">Na aula: {{ pergunta.aula.titulo }}</div>
                            </li>
                        {% empty %}
                            <li class="list-group-item text-muted">Você ainda não fez nenhuma pergunta.</li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Aba 4: Minhas Respostas -->
                <div class="tab-pane fade" id="respostas" role="tabpanel" aria-labelledby="respostas-tab">
                    <h2 class="h4 mb-3">Minhas Respostas</h2>
                    <ul class="list-group">
                        {% for resposta in minhas_respostas %}
                            <li class="list-group-item">
                                <a href="{% url 'cursos:ver_aula' pk=resposta.pergunta.aula.pk %}">
                                    "{{ resposta.conteudo|truncatewords:15 }}"
                                </a>
                                <div class="small text-muted mt-1">Respondendo na aula: {{ resposta.pergunta.aula.titulo }}</div>
                            </li>
                        {% empty %}
                            <li class="list-group-item text-muted">Você ainda não deu nenhuma resposta.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
